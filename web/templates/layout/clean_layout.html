<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <script src="/static/htmx.min.js"></script>
    <script>
      (function() {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (saved === 'dark' || (!saved && prefersDark)) {
          document.documentElement.classList.add('dark-mode');
        }
      })();
    </script>
    {{ block "custom_head" .}}
    <title>PoliPlanner</title>
    {{ end }}
  </head>
  <body>
    <header role="banner">
      <nav role="navigation" aria-label="Principal">
        <div class="nav-top">
          <a href="/" class="contrast logo" style="font-weight: var(--font-weight-bold);">
            <span class="icon"><i class="bi bi-calendar3"></i></span>
            PoliPlanner
          </a>
        </div>
        <ul class="nav-links">
          <li class="right-menu-item">
            <a href="/misc/calculator">
              <span class="icon"><i class="bi bi-calculator"></i></span> Calculadora
            </a>
          </li>
          <li class="right-menu-item">
            <a href="/misc/">
              <span class="icon"><i class="bi bi-wrench"></i></span> Herramientas
            </a>
          </li>
          <li class="right-menu-item">
            <a href="/guides">
              <span class="icon"><i class="bi bi-journal-text"></i></span> Guías
            </a>
          </li>
        </ul>
        <button class="burguer" aria-label="Menú">
          <i class="bi bi-list"></i>
        </button>
      </nav>
    </header>
    <!-- modal mobile -->
    <div id="mobile-menu-modal">
      <button id="mobile-menu-close">
        <i class="bi bi-x"></i>
      </button>
      <div id="mobile-menu-content">
        <!-- Se llena automáticamente con JS -->
      </div>
    </div>
    {{ block "content" . }}
    {{ end }}
    <button
      id="theme-toggle"
      class="theme-toggle-btn"
      aria-label="Cambiar tema"
      title="Cambiar tema"
      type="button"
    >
      <i class="bi bi-moon"></i>
    </button>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const burger = document.querySelector('.burguer');
        const modal = document.getElementById('mobile-menu-modal');
        const closeBtn = document.getElementById('mobile-menu-close');
        if (burger) {
          burger.addEventListener('click', () => {
            modal.classList.add('open');
          });
        }
        if (closeBtn) {
          closeBtn.addEventListener('click', () => {
            modal.classList.remove('open');
          });
        }
        window.addEventListener('resize', () => {
          if (window.innerWidth > 768 && modal.classList.contains('open')) {
            modal.classList.remove('open');
          }
        });
        const themeToggle = document.getElementById('theme-toggle');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (themeToggle) {
          if (localStorage.getItem('theme') === 'dark' ||
              (!localStorage.getItem('theme') && prefersDark)) {
            themeToggle.innerHTML = '<i class="bi bi-sun"></i>';
          } else {
            themeToggle.innerHTML = '<i class="bi bi-moon"></i>';
          }
          themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeToggle.innerHTML = isDark
              ? '<i class="bi bi-sun"></i>'
              : '<i class="bi bi-moon"></i>';
          });
        }

        // Duplicar menú para mobile (íconos iguales)
        const desktopMenu = document.querySelector('.nav-links');
        const mobileMenuContent = document.getElementById('mobile-menu-content');
        if (desktopMenu && mobileMenuContent) {
          mobileMenuContent.innerHTML = '';
          const links = desktopMenu.querySelectorAll('li.right-menu-item > a');
          links.forEach(link => {
            const newLink = link.cloneNode(true);
            mobileMenuContent.appendChild(newLink);
          });
        }
      });
    </script>
  </body>
</html>
