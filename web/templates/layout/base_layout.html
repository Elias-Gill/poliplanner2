<!DOCTYPE html>
<html lang="es" class="default-theme">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- styles -->
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="stylesheet" href="/static/palette.css" />

    <!-- htmx -->
    <script src="/static/htmx.min.js"></script>

    <!-- external resources -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- theme bootstrap -->
    <script>
      (function () {
        const root = document.documentElement;

        const theme = localStorage.getItem("theme") || "default-theme";
        const mode = localStorage.getItem("mode");

        root.classList.add(theme);

        if (mode === "dark") {
          root.classList.add("dark-mode");
        } else if (!mode) {
          const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches;
          if (prefersDark) {
            root.classList.add("dark-mode");
          }
        }
      })();
    </script>

    {{ block "custom_head" . }}{{ end }}
    <title>PoliPlanner</title>
  </head>

  <body>
    <header role="banner">
      <nav role="navigation" aria-label="Principal">
        <div class="nav-top">
          <a
            href="/"
            class="contrast logo"
            style="font-weight: var(--font-weight-bold)" >
            <span class="icon"><i class="bi bi-calendar3"></i></span> PoliPlanner
          </a>
        </div>

        <ul class="nav-links">
          <li class="right-menu-item">
            <a href="/misc/calculator">
              <span class="icon"><i class="bi bi-calculator"></i></span>
              Calculadora
            </a>
          </li>
          <li class="right-menu-item">
            <a href="/misc/">
              <span class="icon"><i class="bi bi-wrench"></i></span> Herramientas
            </a>
          </li>
          <li class="right-menu-item">
            <a href="/guides">
              <span class="icon"><i class="bi bi-journal-text"></i></span> Guías
            </a>
          </li>
          <li class="right-menu-item">
            <a href="/user">
              <span class="icon"><i class="bi bi-gear"></i></span> Configuracion
            </a>
          </li>
        </ul>

        <button class="burguer" aria-label="Menú" type="button">
          <i class="bi bi-list"></i>
        </button>
      </nav>
    </header>

    <!-- modal mobile -->
    <div id="mobile-menu-modal">
      <button id="mobile-menu-close" type="button">
        <i class="bi bi-x"></i>
      </button>
      <div id="mobile-menu-content"></div>
    </div>

    {{ block "content" . }}{{ end }}

    <!-- dark / light toggle -->
    <button
      id="theme-toggle"
      class="theme-toggle-btn"
      aria-label="Cambiar modo y tema"
      type="button"
    >
      <i class="bi bi-moon"></i>
    </button>
    <small id="theme-hint" hidden>
        Manten presionado para cambiar de tema
    </small>

    <!-- Paleta de temas -->
    <div id="palette-selector" aria-label="Selector de temas">
      <button type="button" data-theme="default-theme">Default</button>
      <button type="button" data-theme="theme-warm">Warm</button>
      <button type="button" data-theme="theme-forest">Forest</button>
      <button type="button" data-theme="theme-lavender">Lavender</button>
      <button type="button" data-theme="theme-pink">Pink</button>
    </div>

    <footer>
      <div>
        © 2025 <strong>PoliPlanner2 (Web)</strong> — Desarrollado por
        <a href="https://github.com/elias-gill">Elias Gill</a>
      </div>
    </footer>

    <!-- theme selector hint -->
    <script>
        const hint = document.getElementById("theme-hint");
        const toggle = document.getElementById("theme-toggle");

        if (hint && toggle) {
          const hasSeenHint = localStorage.getItem("theme-hint-seen");

          // Por defecto oculto
          hint.hidden = true;

          // Mostrar hint automáticamente solo la primera vez
          if (!hasSeenHint) {
            hint.hidden = false;

            // Ocultar el hint al primer mouseleave o touchend y guardar en localStorage
            const hideAndSave = () => {
              hint.hidden = true;
              localStorage.setItem("theme-hint-seen", "true");
              toggle.removeEventListener("mouseleave", hideAndSave);
              toggle.removeEventListener("touchend", hideAndSave);
            };

            toggle.addEventListener("mouseleave", hideAndSave);
            toggle.addEventListener("touchend", hideAndSave);
          }

          // Eventos normales para mostrar/ocultar hint
          toggle.addEventListener("mouseenter", () => {
            hint.hidden = false;
          });

          toggle.addEventListener("mouseleave", () => {
            // Solo ocultar si ya vio el hint la primera vez
            if (localStorage.getItem("theme-hint-seen")) {
              hint.hidden = true;
            }
          });

          // Soporte táctil básico
          toggle.addEventListener("touchstart", () => {
            hint.hidden = false;
          });

          toggle.addEventListener("touchend", () => {
            if (localStorage.getItem("theme-hint-seen")) {
              hint.hidden = true;
            }
          });
        }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const root = document.documentElement;
        let paletteTimeout = null;

        /* mobile menu */
        const burger = document.querySelector(".burguer");
        const modal = document.getElementById("mobile-menu-modal");
        const closeBtn = document.getElementById("mobile-menu-close");

        if (burger) {
          burger.addEventListener("click", () => {
            modal.classList.add("open");
          });
        }

        if (closeBtn) {
          closeBtn.addEventListener("click", () => {
            modal.classList.remove("open");
          });
        }

        window.addEventListener("resize", () => {
          if (window.innerWidth > 768 && modal.classList.contains("open")) {
            modal.classList.remove("open");
          }
        });

        /* dark / light toggle */
        const themeToggle = document.getElementById("theme-toggle");
        const paletteSelector = document.getElementById("palette-selector");

        const updateToggleIcon = () => {
          themeToggle.innerHTML = root.classList.contains("dark-mode")
            ? '<i class="bi bi-sun"></i>'
            : '<i class="bi bi-moon"></i>';
        };

        updateToggleIcon();

        // Alterna modo claro / oscuro con click normal
        themeToggle.addEventListener("click", (e) => {
          // Solo alternar si no estamos mostrando la paleta
          if (!paletteSelector.classList.contains('visible')) {
            const isDark = root.classList.toggle("dark-mode");
            localStorage.setItem("mode", isDark ? "dark" : "light");
            updateToggleIcon();
          }
        });

        // Función para ocultar la paleta
        const hidePalette = () => {
          paletteSelector.classList.remove("visible");
          clearTimeout(paletteTimeout);
        };

        // Mostrar paleta al mantener presionado (móvil y desktop)
        themeToggle.addEventListener("mousedown", () => {
          paletteTimeout = setTimeout(() => {
            paletteSelector.classList.add("visible");
          }, 500); // 500ms para evitar activaciones accidentales
        });

        themeToggle.addEventListener("mouseup", () => {
          clearTimeout(paletteTimeout);
        });

        themeToggle.addEventListener("mouseleave", () => {
          clearTimeout(paletteTimeout);
        });

        // También para touch devices
        themeToggle.addEventListener("touchstart", () => {
          paletteTimeout = setTimeout(() => {
            paletteSelector.classList.add("visible");
          }, 500);
        });

        themeToggle.addEventListener("touchend", () => {
          clearTimeout(paletteTimeout);
        });

        // Ocultar paleta al hacer clic fuera
        document.addEventListener("click", (e) => {
          if (!themeToggle.contains(e.target) && !paletteSelector.contains(e.target)) {
            hidePalette();
          }
        });

        // Ocultar paleta en móvil al hacer scroll
        window.addEventListener("scroll", () => {
          if (window.innerWidth <= 768) {
            hidePalette();
          }
        });

        // Selección de tema
        paletteSelector.addEventListener("click", (e) => {
          if (e.target.tagName === "BUTTON") {
            const theme = e.target.dataset.theme;

            root.classList.remove(
              "default-theme",
              "theme-warm",
              "theme-forest",
              "theme-lavender",
              "theme-pink",
            );
            root.classList.add(theme);
            localStorage.setItem("theme", theme);

            hidePalette();
          }
        });

        /* duplicate menu for mobile */
        const desktopMenu = document.querySelector(".nav-links");
        const mobileMenuContent = document.getElementById("mobile-menu-content");

        if (desktopMenu && mobileMenuContent) {
          mobileMenuContent.innerHTML = "";
          const links = desktopMenu.querySelectorAll("li.right-menu-item > a");
          links.forEach((link) => {
            mobileMenuContent.appendChild(link.cloneNode(true));
          });
        }
      });
    </script>

  </body>
</html>
