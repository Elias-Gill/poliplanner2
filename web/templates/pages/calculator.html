{{ define "custom_head" }}
<head>
  <title>Calculadora - PoliPlanner</title>
</head>
{{ end }}
{{ define "content" }}
<main>
  <h1>Calculadora de Notas</h1>
  <article>
    <h2>A) Ya tengo mi promedio ponderado</h2>
    <p>
      Ingresa tu promedio ponderado (0–100) y obtén los puntajes mínimos del examen final para cada nota 2–5.
    </p>
    <form id="formPonderado" onsubmit="return false;">
      <div class="form-group">
        <label for="inputPonderado">Promedio ponderado (0–100)</label>
        <input type="number" id="inputPonderado" min="0" max="100" step="1" />
      </div>
      <button id="btnPonderado" type="button">Calcular</button>
    </form>
  </article>
  <article>
    <h2>B) Calcular promedio ponderado y examen</h2>
    <p>
      Introduce tus promedios y pesos (que sumen 100) para calcular tu promedio ponderado y los puntajes del examen.
    </p>
    <form id="formComponentes" onsubmit="return false;">
      <div class="flex-row">
        <div class="form-group">
          <label for="pesoParciales">Peso Parciales (%)</label>
          <input type="number" id="pesoParciales" min="0" max="100" value="0" />
          <label for="promParciales">Promedio Parciales (0–100)</label>
          <input type="number" id="promParciales" min="0" max="100" value="0" />
        </div>
        <div class="form-group">
          <label for="pesoTareas">Peso Tareas (%)</label>
          <input type="number" id="pesoTareas" min="0" max="100" value="0" />
          <label for="promTareas">Promedio Tareas (0–100)</label>
          <input type="number" id="promTareas" min="0" max="100" value="0" />
        </div>
        <div class="form-group">
          <label for="pesoLab">Peso Laboratorios (%)</label>
          <input type="number" id="pesoLab" min="0" max="100" value="0" />
          <label for="promLab">Promedio Lab. (0–100)</label>
          <input type="number" id="promLab" min="0" max="100" value="0" />
        </div>
      </div>
      <button id="btnComponentes" type="button">Calcular</button>
    </form>
  </article>
  <article id="resultados">
    <h2>Puntajes mínimos requeridos</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Nota final</th>
            <th>Puntaje requerido</th>
          </tr>
        </thead>
        <tbody id="resultadoTabla"></tbody>
      </table>
    </div>
  </article>
  <section>
    Si quieres saber cómo se calculan las notas puedes visitar la guía de 
    <a href="/guides/calculo_notas">Cálculo de Notas</a>.
  </section>
  <script>
    const MIN_EXAM = 50;

    const UMBRALES_NOTAS = [
        { min: 91, nota: 5 },
        { min: 81, nota: 4 },
        { min: 71, nota: 3 },
        { min: 60, nota: 2 },
    ];

    function calcularNotaFinal(ponderado, examen) {
        const puntajeFinal = 0.4 * ponderado + 0.6 * examen;
        for (const u of UMBRALES_NOTAS) {
            if (puntajeFinal >= u.min) return u.nota;
        }
        return 1;
    }

    function calcularExamenNecesario(ponderado, notaDeseada) {
        const u = UMBRALES_NOTAS.find(x => x.nota === notaDeseada);
        if (!u) return NaN;

        let examen = (u.min - 0.4 * ponderado) / 0.6;
        examen = Math.max(examen, MIN_EXAM);
        examen = Math.floor(examen);
        return examen > 100 ? '-' : examen;
    }

    function calcularTabla(ponderado) {
        const tbody = document.getElementById('resultadoTabla');
        tbody.innerHTML = '';

        for (let n = 5; n >= 2; n--) {
            const req = calcularExamenNecesario(ponderado, n);
            tbody.insertAdjacentHTML('beforeend', `
              <tr>
                <td>${n}</td>
                <td>${req}</td>
              </tr>
            `);
        }

        document.getElementById('resultados').scrollIntoView({ behavior: 'smooth' });
    }

    document.getElementById('btnPonderado').onclick = () => {
        const v = parseInt(document.getElementById('inputPonderado').value);
        if (isNaN(v) || v < 0 || v > 100) {
            alert('Ingresa un promedio válido (0–100)');
            return;
        }
        calcularTabla(v);
    };

    document.getElementById('btnComponentes').onclick = () => {
        const p1 = parseInt(document.getElementById('pesoParciales').value) || 0;
        const p2 = parseInt(document.getElementById('pesoTareas').value) || 0;
        const p3 = parseInt(document.getElementById('pesoLab').value) || 0;

        if (p1 + p2 + p3 !== 100) {
            alert('La suma de los pesos debe ser 100');
            return;
        }

        const m1 = parseInt(document.getElementById('promParciales').value);
        const m2 = parseInt(document.getElementById('promTareas').value);
        const m3 = parseInt(document.getElementById('promLab').value);

        if ([m1, m2, m3].some(x => isNaN(x) || x < 0 || x > 100)) {
            alert('Promedios deben ser números entre 0 y 100');
            return;
        }

        const ponderado = (m1 * p1 + m2 * p2 + m3 * p3) / 100;
        calcularTabla(ponderado);
    };
  </script>
  <style>
    main {
    max-width: 600px;
    margin: 2rem auto;
    padding: 1rem;
    }

    h1 {
    text-align: center;
    margin-bottom: 2rem;
    letter-spacing: 0.1em;
    font-weight: 700;
    }

    article {
    margin-bottom: 2rem;
    padding: 1rem 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 0 8px rgb(0 0 0 / 0.1);
    }

    article h2 {
    margin-bottom: 1rem;
    font-weight: 600;
    border-bottom: 2px solid var(--color-primary);
    padding-bottom: 0.25rem;
    }

    p {
    margin-bottom: 1rem;
    color: var(--color-muted);
    font-size: 0.95rem;
    }

    .form-group {
    margin-bottom: 1.2rem;
    display: flex;
    flex-direction: column;
    }

    .form-group label {
    margin-bottom: 0.3rem;
    font-weight: 500;
    }

    .form-group input[type="number"] {
    padding: 0.5rem 0.7rem;
    font-size: 1rem;
    border: 1px solid var(--color-border);
    border-radius: 0.3rem;
    transition: border-color 0.2s ease;
    }

    .form-group input[type="number"]:focus {
    border-color: var(--color-primary);
    outline: none;
    }

    .flex-row {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    }

    .flex-row .form-group {
    flex: 1 1 30%;
    min-width: 150px;
    }

    button {
    width: 100%;
    padding: 0.7rem;
    font-weight: 600;
    font-size: 1.05rem;
    border-radius: 0.35rem;
    margin-top: 0.5rem;
    background-color: var(--color-primary);
    color: white;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
    }

    button:hover {
    background-color: color-mix(in srgb, var(--color-primary), black 25%);
    }

    .table-container {
    margin-top: 1rem;
    overflow-x: auto;
    }

    section {
    text-align: center;
    font-size: 0.9rem;
    color: var(--color-muted);
    margin-top: 1.5rem;
    }

    section a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 600;
    }

    section a:hover {
    text-decoration: underline;
    }
  </style>
</main>
{{ end }}
